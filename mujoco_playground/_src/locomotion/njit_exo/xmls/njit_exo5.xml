<mujoco model="KF_NJIT_Rehab_Exo">
  <compiler angle="radian" meshdir="assets" autolimits="true"/>

  <option iterations="3" ls_iterations="5" timestep="0.002" integrator="Euler">
    <flag eulerdamp="disable"/>
  </option>

  <default>
    <geom type="mesh" solimp="0.95 0.99 0.001" solref="0.005 1"/>
    
    <default class="visual">
      <geom group="1" type="mesh" contype="0" conaffinity="0" rgba="0.48 0.48 0.48 1"/>
    </default>
    <default class="collision">
      <geom group="0" type="box" rgba="0.8 0.2 0.2 0.5"/>
    </default>

    <default class="motorized">
       <joint damping="1.0" frictionloss="0.5" armature="0.01"/>
    </default>
  </default>

  <worldbody>
    <body name="base" pos="0 0 0">
      <freejoint name="root"/> 
      
      <inertial pos="0 0 0" mass="0.01" fullinertia="1e-4 1e-4 1e-4 0 0 0"/>

      <body name="exo_pelvis" pos="0 0 0" euler="1.5707 0 0">
        <inertial pos="0.164969 -0.016465 -0.00031201" mass="3.40529" fullinertia="0.108005 0.140273 0.0409718 0.00342849 0.00011722 -6.056e-05"/>
        <geom type="box" size="0.15 0.05 0.25" pos="0.134969 -0.016465 -0.00031201" class="visual"/>
        
        <site name="imu" pos="0 0 0" euler="-1.5707 0 0" size="0.01" rgba="1 0 0 1"/>

        <body name="Battery" pos="0 0 0">
           <inertial pos="-0.0292753 0.0823604 -0.00041407" mass="2.2" fullinertia="0.00909547 0.00798838 0.00423978 -0.00038364 -7.94e-06 -3.83e-06"/>
        </body>

        <body name="r_exo_femur" pos="0.25 -0.06 0.21">
          <inertial pos="-0.00012287 -0.205637 0.0391034" mass="2.77725" fullinertia="0.0378701 0.00419727 0.0353309 7.8e-05 -0.00043864 -0.00038322"/>
          <joint name="r_exo_femur" class="motorized" axis="0 0 1" range="-1.309 1.309"/>
          <geom type="cylinder" size="0.03 0.25" pos="-0.00012287 -0.205637 0.0201034" euler="1.57 0 0" class="visual"/>

          <body name="r_exo_tibia" pos="0 -0.41 0">
            <inertial pos="0.00130324 -0.0640757 0.0163233" mass="0.60426" fullinertia="0.00549709 0.00033891 0.00532813 -4.48e-05 -6.27e-06 -0.00064841"/>
            <joint name="r_exo_tibia" class="motorized" axis="0 0 1" range="-2.094 0.0"/>
            <geom type="cylinder" size="0.03 0.175" pos="0.00130324 -0.2240757 0.0163233" euler="1.57 0 0" class="visual"/>

            <body name="r_shank_support" pos="0 -0.25 0">
              <inertial pos="-0.0220563 -0.0501763 -0.0332489" mass="0.24824" fullinertia="0.0009242 0.00070211 0.00054663 0.00012989 -0.00019488 0.00018796"/>

              <body name="r_ankle_coupling" pos="0 -0.129 0">
                <inertial pos="0.0270888 -0.0211255 -0.0183098" mass="0.194678" fullinertia="0.00020434 0.00086131 0.00083139 -0.00019895 -3.6e-07 -1.193e-05"/>
                <joint name="r_ankle_coupling" class="motorized" axis="0 0 1" range="-0.6981 0.2618"/>
                <geom type="cylinder" size="0.0254 0.0127" pos="-0.0784998 -0.1185 -0.135" class="visual"/>

                <body name="r_foot" pos="0.11 0.001 -0.0699999" euler="0 0 0.29">
                  <inertial pos="-0.0647188 -0.0863198 0.00643328" mass="1.39879" fullinertia="0.00411567 0.0161809 0.0165848 0.00314958 -0.00066379 -0.00019919"/>
                  <joint name="r_foot" class="motorized" axis="1 0 0" range="-0.2618 0.2618"/>
                  <geom type="box" size="0.16 0.025 0.075" pos="-0.0647188 -0.0863198 -0.00643328" euler="0 0 -0.285" class="visual"/>
                  
                  <site name="r_foot" pos="0 0 0" euler="-1.57 0 0" size="0.01" rgba="0 0 1 1"/>

                  <body name="r_foot_ground" pos="0 -0.135 0" euler="3.14159 3.14159 2.85159">
                     <geom type="sphere" size="0.02" pos="-0.22 0.02 0.04" rgba="1 0 0 1" group="1"/>
                     <geom type="sphere" size="0.02" pos="0.06 0.02 0.04" rgba="1 0 0 1" group="1"/>
                     <geom type="sphere" size="0.02" pos="-0.22 0.02 -0.04" rgba="1 0 0 1" group="1"/>
                     <geom type="sphere" size="0.02" pos="0.06 0.02 -0.04" rgba="1 0 0 1" group="1"/>
                     <geom name="r_foot_col" type="box" size="0.16 0.02 0.07" pos="-0.08 0.02 0.0" class="collision"/>
                  </body>
                </body>
              </body>
            </body>
          </body>
        </body>

        <body name="l_exo_femur" pos="0.25 -0.06 -0.21">
          <inertial pos="-0.00012287 -0.205637 -0.0391034" mass="2.77725" fullinertia="0.0378701 0.00419727 0.0353309 7.8e-05 0.00043864 0.00038322"/>
          <joint name="l_exo_femur" class="motorized" axis="0 0 1" range="-1.309 1.309"/>
          <geom type="cylinder" size="0.03 0.25" pos="-0.00012287 -0.205637 -0.0291034" euler="1.57 0 0" class="visual"/>

          <body name="l_exo_tibia" pos="0 -0.41 0">
            <inertial pos="0.00130324 -0.0640757 -0.0163233" mass="0.60426" fullinertia="0.00549709 0.00033891 0.00532813 -4.48e-05 6.27e-06 0.00064841"/>
            <joint name="l_exo_tibia" class="motorized" axis="0 0 1" range="-2.094 0.0"/>
            <geom type="cylinder" size="0.03 0.175" pos="0.00130324 -0.2240757 -0.0263233" euler="1.57 0 0" class="visual"/>

            <body name="l_shank_support" pos="0 -0.25 0">
              <inertial pos="-0.0220563 -0.0501763 0.0332489" mass="0.24824" fullinertia="0.0009242 0.00070211 0.00054663 0.00012989 0.00019488 -0.00018796"/>

              <body name="l_ankle_coupling" pos="0 -0.129 0">
                <inertial pos="0.0270888 -0.0211255 0.0183098" mass="0.194678" fullinertia="0.00020434 0.00086131 0.00083139 -0.00019895 3.6e-07 1.193e-05"/>
                <joint name="l_ankle_coupling" class="motorized" axis="0 0 1" range="-0.6981 0.2618"/>
                <geom type="cylinder" size="0.0254 0.0127" pos="-0.0784998 -0.1185 0.135" class="visual"/>

                <body name="l_foot" pos="0.11 0.001 0.0699999" euler="0 0 0.29">
                  <inertial pos="-0.0647188 -0.0863198 -0.00643328" mass="1.39879" fullinertia="0.00411567 0.0161809 0.0165848 0.00314958 0.00066379 0.00019919"/>
                  <joint name="l_foot" class="motorized" axis="-1 0 0" range="-0.2618 0.2618"/>
                  <geom type="box" size="0.16 0.025 0.075" pos="-0.0647188 -0.0863198 -0.00643328" euler="0 0 -0.285" class="visual"/>

                  <site name="l_foot" pos="0 0 0" euler="-1.57 0 0" size="0.01" rgba="0 0 1 1"/>

                  <body name="l_foot_ground" pos="0 -0.135 0" euler="3.14159 3.14159 2.85159">
                     <geom type="sphere" size="0.02" pos="-0.22 0.02 0.04" rgba="1 0 0 1" group="1"/>
                     <geom type="sphere" size="0.02" pos="0.06 0.02 0.04" rgba="1 0 0 1" group="1"/>
                     <geom type="sphere" size="0.02" pos="-0.22 0.02 -0.04" rgba="1 0 0 1" group="1"/>
                     <geom type="sphere" size="0.02" pos="0.06 0.02 -0.04" rgba="1 0 0 1" group="1"/>
                     <geom name="l_foot_col" type="box" size="0.16 0.02 0.07" pos="-0.08 0.02 0.0" class="collision"/>
                  </body>
                </body>
              </body>
            </body>
          </body>
        </body>
        
      </body>
    </body>
  </worldbody>

  <actuator>
    <position name="r_hip" joint="r_exo_femur" kp="200" forcerange="-100 100" ctrllimited="true" ctrlrange="-1.3 1.3"/>
    <position name="l_hip" joint="l_exo_femur" kp="200" forcerange="-100 100" ctrllimited="true" ctrlrange="-1.3 1.3"/>
    <position name="r_knee" joint="r_exo_tibia" kp="200" forcerange="-100 100" ctrllimited="true" ctrlrange="-2.0 0"/>
    <position name="l_knee" joint="l_exo_tibia" kp="200" forcerange="-100 100" ctrllimited="true" ctrlrange="-2.0 0"/>
    
    <position name="r_ankle" joint="r_ankle_coupling" kp="50" forcerange="-50 50" ctrllimited="true" ctrlrange="-0.7 0.3"/>
    <position name="l_ankle" joint="l_ankle_coupling" kp="50" forcerange="-50 50" ctrllimited="true" ctrlrange="-0.7 0.3"/>
    <position name="r_toe" joint="r_foot" kp="30" forcerange="-20 20" ctrllimited="true" ctrlrange="-0.3 0.3"/>
    <position name="l_toe" joint="l_foot" kp="30" forcerange="-20 20" ctrllimited="true" ctrlrange="-0.3 0.3"/>
  </actuator>

  <sensor>
    <jointpos name="r_hip_pos"   joint="r_exo_femur"/>
    <jointpos name="l_hip_pos"   joint="l_exo_femur"/>
    <jointpos name="r_knee_pos"  joint="r_exo_tibia"/>
    <jointpos name="l_knee_pos"  joint="l_exo_tibia"/>
    <jointpos name="r_ankle_pos" joint="r_ankle_coupling"/>
    <jointpos name="l_ankle_pos" joint="l_ankle_coupling"/>
    
    <jointvel name="r_hip_vel"   joint="r_exo_femur"/>
    <jointvel name="l_hip_vel"   joint="l_exo_femur"/>
    <jointvel name="r_knee_vel"  joint="r_exo_tibia"/>
    <jointvel name="l_knee_vel"  joint="l_exo_tibia"/>
    <jointvel name="r_ankle_vel" joint="r_ankle_coupling"/>
    <jointvel name="l_ankle_vel" joint="l_ankle_coupling"/>

    <accelerometer name="accelerometer" site="imu"/>
    <gyro name="gyro" site="imu"/>
    <framezaxis name="upvector" objtype="site" objname="imu"/>
    
    <velocimeter name="local_linvel" site="imu"/>
    <framelinvel name="global_linvel" objtype="site" objname="imu"/>
    <frameangvel name="global_angvel" objtype="site" objname="imu"/>
    
    <framepos name="l_foot_pos" objtype="site" objname="l_foot"/>
    <framepos name="r_foot_pos" objtype="site" objname="r_foot"/>

    <velocimeter name="l_foot_global_linvel" site="l_foot"/>
    <velocimeter name="r_foot_global_linvel" site="r_foot"/>
  </sensor>

</mujoco>